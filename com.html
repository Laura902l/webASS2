<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@3.0.9/dist/css/splide.min.css">

    <!-- title -->
    <title>cuisine</title>
    <link rel="stylesheet" href="breakfast.css">
    <!-- favicon -->
    <link rel="icon" href="C:\Users\User\.vscode\web_tech11\bakery_img\favicon.ico">
    <!-- font -->
    <link href='//fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,400,600,700' rel='stylesheet'
        type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Marck+Script" rel="stylesheet">
    <!-- social icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <style>
      
        /* ваш стиль здесь */

        /* Дополнительные стили для форума */
        .comment {
            margin-bottom: 15px;
        }

        .comment-info {
            color: #acacac;
            font-size: 12px;
        }

        .reply-btn {
            margin-top: 10px;
        }

        .reply-form {
            margin-top: 10px;
            display: none;
        }
    </style>
</head>

<body>
    <!-- our icons -->
    <div style="background-color: #F7F4ED;">
        <div class="container-fluid">
            <div class="row justify-content-center align-items-center ">
                <div class="col-sm-6">
                    <a href="index.html"><img src="photo/Our icon.png" alt="" width="90%"></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation bar -->
    <div class="container-fluid ">

        <nav class="navbar navbar-expand-lg navbar-light bg-white">
            <!-- Home -->
            <a class="navbar-brand px-4 ml-5" href="index.html">
                Home
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" fill="currentColor" class="bi bi-house"
                    viewBox="0 0 16 16">
                    <path
                        d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z" />
                </svg>
            </a>

            <!-- login -->
            <a class="navbar-brand  px-4" onclick="goToProfile()">
                <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-person"
                    viewBox="0 0 16 16">
                    <path
                        d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z" />
                </svg>
            </a>

            <!-- dropdown -->
            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuL">
                <a class="dropdown-item text-primary" href="index.html">About us</a>
                <a class="dropdown-item text-primary" href="#c2">Contact Info</a>
                <a class="dropdown-item text-primary" href="#c2">Important link</a>
                <div id="userSection" class="dropdown-item">
                    <div type="button" id="profileButton" onclick="goToProfile()">Profile</div>
                </div>
            </div>

            <!-- button navbar-toggler -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">

                <ul class="navbar-nav">
                    <!-- Breakfast -->
                    <li class="nav-item active px-4">
                        <a class="nav-link  " href="breakfast.html">Breakfast <span class="sr-only">(current)</span></a>
                    </li>
                    <!-- Cake -->
                    <li class="nav-item px-4">
                        <a class="nav-link " href="cake.html">Cake</a>
                    </li>
                    <!-- Cupcake -->
                    <li class="nav-item px-4 ">
                        <a class="nav-link " href="cupcake.html">Cupcake</a>
                    </li>
                    <!-- More options -->
                    <li class="nav-item dropdown px-4">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            More
                        </a>
                        <div class="dropdown-menu text-muted" aria-labelledby="navbarDropdownMenuLink">
                            <a class="dropdown-item" href="index.html">About us</a>
                            <a class="dropdown-item" href="#c2">Contact Info</a>
                            <a class="dropdown-item" href="#c2">Important link</a>

                        </div>
                    </li>

                    <li class="nav-item dropdown px-4">
                        <a class="nav-link" href="store.html">
                            Shop <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-shop" viewBox="0 0 16 16">
                                <path
                                    d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5zM4 15h3v-5H4v5zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3zm3 0h-2v3h2v-3z" />
                            </svg>
                        </a>

                    </li>
                </ul>
            </div>

        </nav>


    <!-- Comment Section -->
    <section class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <div class="panel">
                    <div class="panel-body">
                        <textarea id="commentInput" class="form-control" rows="2"
                            placeholder="Добавьте Ваш комментарий"></textarea>
                        <input type="file" id="photoInput" accept="image/*">
                        <div class="mar-top clearfix">
                            <button class="btn btn-sm btn-primary pull-right" onclick="submitComment()">
                                <i class="fa fa-pencil fa-fw"></i> Добавить
                            </button>
                        </div>
                    </div>
                </div>
                <div id="commentsContainer">
                    <!-- Здесь будут отображаться комментарии -->
                </div>
            </div>
        </div>
    </section>

        <script>
            function getLocalStorageItem(key) {
                return localStorage.getItem(key);
            }

            function setLocalStorageItem(key, value) {
                localStorage.setItem(key, value);
            }

            function getUserEmail() {
                // Вместо использования жестко закодированной почты, здесь можно добавить свой механизм получения почты пользователя из локального хранилища
                // Например, если вы храните почту под ключом "userEmail":
                return getLocalStorageItem('userEmail') || 'example@example.com';
            }

            function submitComment() {
                const commentText = document.getElementById('commentInput').value.trim();
                const photoInput = document.getElementById('photoInput');
                const userEmail = getUserEmail();

                if (commentText !== '') {
                    const commentsKey = 'comments';
                    const existingComments = JSON.parse(getLocalStorageItem(commentsKey)) || [];

                    const comment = {
                        text: commentText,
                        user: userEmail,
                        time: new Date().toLocaleString(),
                        photo: null,
                        replies: []
                    };

                    // Обрабатываем фото, если оно загружено
                    if (photoInput.files.length > 0) {
                        const photoFile = photoInput.files[0];
                        // Вместо null используйте свой механизм сохранения файла
                        comment.photo = null;
                    }

                    existingComments.push(comment);
                    setLocalStorageItem(commentsKey, JSON.stringify(existingComments));

                    document.getElementById('commentInput').value = '';
                    displayComments();
                    console.log('Comment added successfully:', comment);
                } else {
                    alert('Введите комментарий перед отправкой.');
                }
            }

            function displayComments() {
                const commentsKey = 'comments';
                const existingComments = JSON.parse(getLocalStorageItem(commentsKey)) || [];
                const commentsContainer = document.getElementById('commentsContainer');

                commentsContainer.innerHTML = '';

                existingComments.forEach(function (comment) {
                    const commentElement = document.createElement('div');
                    commentElement.className = 'comment';

                    commentElement.innerHTML = `
                <p>${comment.text}</p>
                <div class="comment-info">
                    <span>${comment.user}</span> | <span>${comment.time}</span>
                </div>
                ${comment.photo ? `<img src="${comment.photo}" alt="Фото">` : ''}
                <button class="btn btn-sm btn-default reply-btn" onclick="toggleReplyForm(this)">
                    Ответить
                </button>
                <div class="reply-form">
                    <textarea class="form-control" rows="2" placeholder="Ваш ответ"></textarea>
                    <button class="btn btn-sm btn-primary" onclick="submitReply(this)">
                        Отправить ответ
                    </button>
                </div>
            `;

                    commentsContainer.appendChild(commentElement);
                });

                console.log('Comments displayed successfully:', existingComments);
            }
            function toggleReplyForm(button) {
                const replyForm = button.nextElementSibling;
                const displayStyle = window.getComputedStyle(replyForm).getPropertyValue('display');
            
                replyForm.style.display = displayStyle === 'none' ? 'block' : 'none';
            }
            function submitReply(button) {
                const replyForm = button.parentElement;
                const replyText = replyForm.querySelector('textarea').value.trim();
            
                if (replyText !== '') {
                    const commentsKey = 'comments';
                    const existingComments = JSON.parse(getLocalStorageItem(commentsKey)) || [];
                    const userEmail = getUserEmail();
                    // Найти ближайший элемент с классом 'comment'
                    let currentElement = button;
                    while (!currentElement.classList.contains('comment')) {
                        currentElement = currentElement.parentElement;
                    }
            
                    const commentIndex = Array.from(currentElement.parentElement.children).indexOf(currentElement);
            
                    // Ensure that existingComments[commentIndex] and replies are defined
                    if (existingComments[commentIndex] && existingComments[commentIndex].replies) {
                        const reply = {
                            text: replyText,
                            user: userEmail,
                            time: new Date().toLocaleString()
                        };
            
                        // Ensure that replies array exists before pushing
                        if (!existingComments[commentIndex].replies) {
                            existingComments[commentIndex].replies = [];
                        }
            
                        existingComments[commentIndex].replies.push(reply);
                        setLocalStorageItem(commentsKey, JSON.stringify(existingComments));
            
                        replyForm.querySelector('textarea').value = '';
                        displayComments();
                    } else {
                        console.error('Error adding reply: existingComments or replies is undefined.');
                    }
                } else {
                    alert('Введите ответ перед отправкой.');
                }
            }
            
            
            displayComments();
        </script>

</body>

</html>